Understanding Path Traversal Vulnerability in Express.js 🛑🛤️

1. What is Path Traversal?
 
    Path traversal is a security vulnerability that allows an attacker to access restricted files on a server by manipulating file paths.

2. How It Works?
 
    Imagine a file-serving Express.js route like this:

        app.get('/file/:filename', (req, res) => {
            let filename = req.params.filename;
            let filepath = __dirname + "/public/" + filename;
            res.sendFile(filepath);
        });

    Now, what if an attacker sends this request?

        GET /file/../../../etc/passwd

    🔄 The server constructs the path:

        /home/user/app/public/../../../etc/passwd

    🚨 BOOM! The .. moves up directories, exposing sensitive files.

3. Diagram of the Attack 🖼️

    📁 Root Directory  
    ├── 📁 app (Server)  
    │   ├── 📁 public (Allowed)  
    │   ├── 📁 config (Sensitive)  
    │   ├── 📁 logs (Sensitive)  
    │   └── 📄 server.js  
    ├── 📁 etc  
    │   ├── 📝 passwd  <-- ❌ Attacker wants this file  
    │   ├── 📝 shadow  


    Attacker uses:

        GET /file/../../../etc/passwd

        👉 Escapes public/ and reaches etc/passwd ⚠️

4. How to Prevent It? 🛡️
    
    ✅ Use path normalization:

        const path = require('path');

        app.get('/file/:filename', (req, res) => {
            let filename = req.params.filename;
            let filepath = path.join(__dirname, "public", filename);

            if (!filepath.startsWith(path.join(__dirname, "public"))) {
                return res.status(403).send("Access Denied! 🚫");
            }

            res.sendFile(filepath);
        });
        
    ✅ Use built-in Express middlewares like express.static().
    ✅ Validate user inputs & allow only expected filenames.
    ✅ Use a web application firewall (WAF) for extra security.

1. Conclusion:

    ❌ Bad: Trusting user input directly
    ✅ Good: Sanitizing & validating paths

