Understanding Path Traversal Vulnerability in Express.js ğŸ›‘ğŸ›¤ï¸

1. What is Path Traversal?
 
    Path traversal is a security vulnerability that allows an attacker to access restricted files on a server by manipulating file paths.

2. How It Works?
 
    Imagine a file-serving Express.js route like this:

        app.get('/file/:filename', (req, res) => {
            let filename = req.params.filename;
            let filepath = __dirname + "/public/" + filename;
            res.sendFile(filepath);
        });

    Now, what if an attacker sends this request?

        GET /file/../../../etc/passwd

    ğŸ”„ The server constructs the path:

        /home/user/app/public/../../../etc/passwd

    ğŸš¨ BOOM! The .. moves up directories, exposing sensitive files.

3. Diagram of the Attack ğŸ–¼ï¸

    ğŸ“ Root Directory  
    â”œâ”€â”€ ğŸ“ app (Server)  
    â”‚   â”œâ”€â”€ ğŸ“ public (Allowed)  
    â”‚   â”œâ”€â”€ ğŸ“ config (Sensitive)  
    â”‚   â”œâ”€â”€ ğŸ“ logs (Sensitive)  
    â”‚   â””â”€â”€ ğŸ“„ server.js  
    â”œâ”€â”€ ğŸ“ etc  
    â”‚   â”œâ”€â”€ ğŸ“ passwd  <-- âŒ Attacker wants this file  
    â”‚   â”œâ”€â”€ ğŸ“ shadow  


    Attacker uses:

        GET /file/../../../etc/passwd

        ğŸ‘‰ Escapes public/ and reaches etc/passwd âš ï¸

4. How to Prevent It? ğŸ›¡ï¸
    
    âœ… Use path normalization:

        const path = require('path');

        app.get('/file/:filename', (req, res) => {
            let filename = req.params.filename;
            let filepath = path.join(__dirname, "public", filename);

            if (!filepath.startsWith(path.join(__dirname, "public"))) {
                return res.status(403).send("Access Denied! ğŸš«");
            }

            res.sendFile(filepath);
        });
        
    âœ… Use built-in Express middlewares like express.static().
    âœ… Validate user inputs & allow only expected filenames.
    âœ… Use a web application firewall (WAF) for extra security.

1. Conclusion:

    âŒ Bad: Trusting user input directly
    âœ… Good: Sanitizing & validating paths

