How File Upload Works Using TCP üì°

    Your frontend sends the file via HTTP POST request to your backend using multipart/form-data.

What is WebKitFormBoundary ü§î?

    Whenever you upload files using HTML forms with multipart/form-data, the browser automatically splits the request into small parts or chunks.

    Each chunk is separated by a boundary string ‚Äî which is randomly generated by the browser.

‚úÖ Example request body:

    --WebKitFormBoundaryABC123
    Content-Disposition: form-data; name="file"; filename="video.mp4"
    Content-Type: video/mp4

    [BINARY DATA HERE]
    --WebKitFormBoundaryABC123--

Why Does WebKitFormBoundary Come 3 Times? ü§Ø

    Place	                            What It Does
    Request Header	                    It tells the backend where the boundary starts.
    Before File Data (Chunk 1)	        Marks the beginning of file data.
    After File Data (Chunk 2)	        Marks the end of the file data.


How to Make Backend Dynamic üîÑ for Any File Type üéØ

    The trick is:

    Detect the start boundary.
    Stream only the file data (skip headers).
    Stop writing when the end boundary comes.


Diagram üî•

    Frontend -----> TCP Server
            (multipart/form-data)
                        |
        ---------------------------------------------------
        | Header (Content-Type, Boundary)                 |
        ---------------------------------------------------
        | --WebKitFormBoundaryXYZ                         |
        | Content-Disposition: form-data; name="file"     |
        | Content-Type: image/png                         |
        ---------------------------------------------------
        | [FILE DATA]                                     |
        ---------------------------------------------------
        | --WebKitFormBoundaryXYZ--                       |
        ---------------------------------------------------
                        |
                Write File Stream
                        |
                    Save File üìÅ



Frontend code:

    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Uploader</title>
    </head>
    <body>
        <h1>File Uploading</h1>
        <form action="http://192.168.100.7:4000" method="post" enctype="multipart/form-data">
            <input type="file" name="file" required>
            <button type="submit">Upload</button>
        </form>
    </body>
    </html>


Backend code:

    import net from 'node:net'
    import {createWriteStream} from 'node:fs'

    const PORT=4000
    const FILE_PATH='filepath'

    const server = net.createServer((socket) => {

        socket.write('HTTP/1.1 200 OK\r\n\r\n')
        const writeStream = createWriteStream(FILE_PATH)

        socket.on('data',(chunk) => {
            writeStream.write(chunk)
            if(/WebKitFormBoundary.+--/.test(chunk.toString())){
                    socket.end('Got file data.')
            }
        })

        socket.on('error',(err) => {
            console.log('Got error',err)
        })

        socket.on('close',() => {
            console.log('Socket is closed.')
        })
    }) 

    server.listen(PORT,() => {
        console.log(Server is running on port: ${PORT})
    })